# 核心功能列表 (Features)

## 已完成功能

### 1. CRUD 管理

**功能描述：**
- 新增 Docker Service Template（支援自訂名稱、Image、Ports、Volumes、環境變數等）
- 修改現有 Template 配置
- 刪除不需要的 Template
- 查詢所有 Template 列表（按建立時間倒序排列）

**技術實作：**
- 使用 Room DAO 的 `@Insert`, `@Update`, `@Delete`, `@Query` 註解
- 透過 Flow 實現即時資料更新，無需手動刷新

---

### 2. 動態 YAML 生成

![YAML 生成流程](../picture/YAML%20生成流程%20(Flowchart).png)

**功能描述：**
- 根據選取的 Template，自動組合成符合 Docker Compose 語法的 `docker-compose.yml` 字串
- 支援一鍵複製到系統剪貼簿
- 自動處理 JSON 格式的環境變數，轉換為 YAML 格式

**生成範例：**

輸入 Template：
```
name: nginx
image: nginx:latest
ports: 80:80,443:443
volumes: ./html:/usr/share/nginx/html
env_vars: {"NGINX_HOST":"example.com"}
restart_policy: always
```

輸出 YAML：
```yaml
version: '3.8'
services:
  nginx:
    image: nginx:latest
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./html:/usr/share/nginx/html
    restart: always
    environment:
      - NGINX_HOST=example.com
```

---

### 3. 資料庫遷移 (Migration)

**功能描述：**
- 實作 Room Migration (V1 → V2 → V3)
- 支援資料庫結構升級，不遺失使用者資料
- 新增 `restart_policy` 欄位時，自動為舊資料補上預設值 `"no"`

---

### 4. 雲端同步 (Supabase Integration)

**功能描述：**
- 將本地 Room 資料備份至 Supabase 雲端資料庫
- 從雲端還原資料至本地裝置
- 支援多裝置間資料同步

**同步策略：**
- **備份 (Backup)：** 讀取本地所有 Template，批次上傳至 Supabase（使用 `upsert` 避免重複）
- **還原 (Restore)：** 下載雲端資料，清空本地資料庫後寫入（全量覆蓋策略）

---

### 5. 關鍵字搜尋

**功能描述：**
- 透過名稱或 Image 名稱快速篩選 Template
- 即時搜尋，無需按下搜尋按鈕

**技術實作：**
```kotlin
@Query("""
    SELECT * FROM service_templates 
    WHERE name LIKE '%' || :query || '%' 
       OR image LIKE '%' || :query || '%' 
    ORDER BY id DESC
""")
fun searchTemplates(query: String): Flow<List<ServiceTemplate>>
```

---

## 已知限制 (Known Issues)

### 1. 環境變數輸入方式

**現況：**
- 目前僅支援 JSON 格式字串輸入（如 `{"KEY":"VALUE"}`）
- 對非技術使用者不夠友善

**未來改進：**
- 加入 Key-Value 動態表單 UI
- 支援新增/刪除環境變數列表
- 提供常用環境變數範本（如 MySQL、Redis）

---

### 2. 雲端同步策略

**現況：**
- 採用「全量覆蓋」策略（下載時清空本地資料）
- 無法處理多裝置同時編輯的衝突

**未來改進：**
- 實作差異化同步（Differential Sync）
- 加入時間戳比對，保留最新版本
- 支援衝突解決機制（如手動選擇保留哪一方資料）

---

### 3. 多 Service 組合

**現況：**
- 目前僅支援單一 Service 的 YAML 生成
- 無法一次選取多個 Template 組合成完整的 `docker-compose.yml`

**未來改進：**
- 加入「購物車」功能，允許勾選多個 Template
- 自動處理 Service 間的依賴關係（`depends_on`）
- 支援自訂 Networks 配置

---

## future (Roadmap)

| 功能 | 優先級 | 預計實作時間 |
|------|--------|-------------|
| Key-Value 環境變數表單 | 高 | 下一版本 |
| 多 Service 組合生成 | 高 | 下一版本 |
| 差異化雲端同步 | 中 | 未來版本 |
| Template 分類管理 | 中 | 未來版本 |
| 匯出/匯入 JSON 檔案 | 低 | 未來版本 |
| 支援 Docker Swarm 模式 | 低 | 未來版本 |
